<!DOCTYPE html>
<html>
<head>
    <title>Gh√©p H√¨nh Trung Thu</title>
    <style>
        body { 
            margin: 0; 
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            color: white; 
            font-family: Arial; 
            text-align: center;
            padding: 20px;
        }
        .puzzle-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 2px;
            width: 306px;
            height: 306px;
            margin: 20px auto;
            border: 2px solid #ffeb3b;
        }
        .puzzle-piece {
            width: 100px;
            height: 100px;
            background-size: 300px 300px;
            cursor: grab;
            border: 1px solid rgba(255,255,255,0.3);
            transition: transform 0.3s;
        }
        .puzzle-piece:hover {
            transform: scale(1.05);
        }
        .timer, .moves {
            font-size: 20px;
            margin: 10px;
            color: #ffeb3b;
        }
        .back-btn { 
            background: #ff6b6b; 
            color: white; 
            border: none; 
            padding: 10px 20px; 
            margin: 10px; 
            cursor: pointer; 
            border-radius: 5px;
        }
        .start-btn {
            background: #4ecdc4;
            color: white;
            border: none;
            padding: 15px 30px;
            margin: 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 18px;
        }
    </style>
</head>
<body>
    <h1>üß© Gh√©p H√¨nh Trung Thu</h1>
    <div class="timer" id="timer">Th·ªùi gian: 60s</div>
    <div class="moves" id="moves">S·ªë l·∫ßn di chuy·ªÉn: 0</div>
    
    <button class="start-btn" onclick="startGame()">B·∫Øt ƒë·∫ßu</button>
    
    <div class="puzzle-container" id="puzzleContainer">
        <!-- C√°c m·∫£nh gh√©p s·∫Ω ƒë∆∞·ª£c th√™m b·∫±ng JS -->
    </div>
    
    <button class="back-btn" onclick="window.close()">ƒê√≥ng</button>

    <script>
        const puzzleContainer = document.getElementById('puzzleContainer');
        let timer;
        let timeLeft = 60;
        let moves = 0;
        let gameStarted = false;

        // T·∫°o m·∫£ng v·ªã tr√≠ correct
        const correctOrder = [0, 1, 2, 3, 4, 5, 6, 7, 8];

        function startGame() {
            if (gameStarted) return;
            
            gameStarted = true;
            timeLeft = 60;
            moves = 0;
            
            document.getElementById('timer').textContent = `Th·ªùi gian: ${timeLeft}s`;
            document.getElementById('moves').textContent = `S·ªë l·∫ßn di chuy·ªÉn: ${moves}`;
            
            createPuzzle();
            startTimer();
        }

        function createPuzzle() {
            puzzleContainer.innerHTML = '';
            
            // T·∫°o m·∫£ng v·ªã tr√≠ ng·∫´u nhi√™n
            let pieces = [...correctOrder];
            shuffleArray(pieces);
            
            // T·∫°o c√°c m·∫£nh gh√©p
            for (let i = 0; i < 9; i++) {
                const piece = document.createElement('div');
                piece.className = 'puzzle-piece';
                piece.dataset.index = pieces[i];
                piece.dataset.correctIndex = i;
                
                // M√†u s·∫Øc thay cho ·∫£nh (c√≥ th·ªÉ thay b·∫±ng background-image)
                const hue = (pieces[i] * 40) % 360;
                piece.style.background = `hsl(${hue}, 70%, 50%)`;
                piece.style.backgroundPosition = 
                    `${-(pieces[i] % 3) * 100}px ${-Math.floor(pieces[i] / 3) * 100}px`;
                
                piece.textContent = pieces[i] + 1;
                piece.style.display = 'flex';
                piece.style.alignItems = 'center';
                piece.style.justifyContent = 'center';
                piece.style.fontSize = '24px';
                piece.style.fontWeight = 'bold';
                
                piece.draggable = true;
                piece.addEventListener('dragstart', handleDragStart);
                piece.addEventListener('dragover', handleDragOver);
                piece.addEventListener('drop', handleDrop);
                piece.addEventListener('dragenter', handleDragEnter);
                piece.addEventListener('dragleave', handleDragLeave);
                
                puzzleContainer.appendChild(piece);
            }
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        let dragSrcElement = null;

        function handleDragStart(e) {
            dragSrcElement = this;
            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/html', this.innerHTML);
            this.style.opacity = '0.4';
        }

        function handleDragOver(e) {
            e.preventDefault();
            return false;
        }

        function handleDragEnter(e) {
            this.classList.add('over');
        }

        function handleDragLeave(e) {
            this.classList.remove('over');
        }

        function handleDrop(e) {
            e.stopPropagation();
            e.preventDefault();
            
            if (dragSrcElement !== this) {
                // Ho√°n ƒë·ªïi v·ªã tr√≠
                const tempHTML = this.innerHTML;
                const tempDataIndex = this.dataset.index;
                const tempBg = this.style.background;
                
                this.innerHTML = dragSrcElement.innerHTML;
                this.dataset.index = dragSrcElement.dataset.index;
                this.style.background = dragSrcElement.style.background;
                
                dragSrcElement.innerHTML = tempHTML;
                dragSrcElement.dataset.index = tempDataIndex;
                dragSrcElement.style.background = tempBg;
                
                moves++;
                document.getElementById('moves').textContent = `S·ªë l·∫ßn di chuy·ªÉn: ${moves}`;
                
                checkWin();
            }
            
            return false;
        }

        function checkWin() {
            const pieces = puzzleContainer.querySelectorAll('.puzzle-piece');
            let isComplete = true;
            
            pieces.forEach((piece, index) => {
                if (parseInt(piece.dataset.index) !== index) {
                    isComplete = false;
                }
            });
            
            if (isComplete) {
                clearInterval(timer);
                alert(`üéâ Ch√∫c m·ª´ng! B·∫°n ƒë√£ gh√©p h√¨nh th√†nh c√¥ng!\nTh·ªùi gian: ${60 - timeLeft}s\nS·ªë l·∫ßn di chuy·ªÉn: ${moves}`);
            }
        }

        function startTimer() {
            clearInterval(timer);
            timer = setInterval(() => {
                timeLeft--;
                document.getElementById('timer').textContent = `Th·ªùi gian: ${timeLeft}s`;
                
                if (timeLeft <= 0) {
                    clearInterval(timer);
                    alert('‚è∞ H·∫øt gi·ªù! H√£y th·ª≠ l·∫°i nh√©!');
                    startGame(); // T·ª± ƒë·ªông restart
                }
            }, 1000);
        }

        // Cho ph√©p drop
        document.addEventListener('dragover', function(e) {
            e.preventDefault();
        });
        
        document.addEventListener('drop', function(e) {
            e.preventDefault();
        });
    </script>
</body>
</html>